"use strict";angular.module("groceriesappApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/planner.html",controller:"PlannerCtrl as planner"}).state("recipe",{url:"/recipe/:id",templateUrl:"views/recipe.html",controller:"RecipeCtrl as recipe"}).state("recipies",{url:"/recipies",templateUrl:"views/recipies.html",controller:"RecipiesCtrl as recipies"})}]),angular.module("groceriesappApp").controller("PlannerCtrl",["$interval","recipefinder","$scope","$timeout",function(a,b,c,d){function e(a,b){this.name=a,this.id=a+b,this.date=b,this.meals=[]}function f(a,b){this.type=a,this.recipe=b}function g(a,b,c){this.name=a,this.servings=b,this.ingredients=c}function h(a,b,c,d){this.name=a,this.unitMass=b,this.mass=c,this.category=d}function i(a,b,c,d){this.name=a,this.unitMass=b,this.mass=c,this.category=d}var j=this,j=this,k=!1;this.currentCity="",this.locationLat="",this.locationLon="",this.country="",this.days=[],this.recipies=[],this.recipiesId="",this.breakfasts=[],this.lunchs=[],this.dinners=[],this.currentDay="";var l="meat, fish and chicken",m="fruits and vegetables",n="milk products";this.meatFishChicken=[],this.fruitsVegetables=[],this.milkProducts=[],this.otherFood=[];var o,p=0;o=a(function(){var a=[],c="",d="",e="",f=[],i="",l="",m="",n="";p>0?b.getPlannerRecipes().then(function(b){if(n=b.id,""!==j.country){if(console.log("pais reconocido"),n!==j.recipiesId||!k){j.recipiesId=b.id,a=b.array,j.recipies=[],k=!0;for(var o=0;o<a.length;o++)if(d=a[o].country,c=a[o].name,e=a[o].servings,d===j.country){for(var p=0;p<a[o].ingredients.length;p++)i=a[o].ingredients[p].name,l=a[o].ingredients[p].mass,m=a[o].ingredients[p].category,f.push(new h(i,l,l,m));j.recipies.push(new g(c,e,f,d)),f=[]}}}else if(n!==j.recipiesId){j.recipiesId=b.id,a=b.array,j.recipies=[];for(var o=0;o<a.length;o++){d=a[o].country,c=a[o].name,e=a[o].servings;for(var p=0;p<a[o].ingredients.length;p++)i=a[o].ingredients[p].name,l=a[o].ingredients[p].mass,m=a[o].ingredients[p].category,f.push(new h(i,l,l,m));j.recipies.push(new g(c,e,f,d)),f=[]}}}):b.getPlannerRecipes().then(function(b){j.recipiesId=b.id,a=b.array;for(var k=0;k<a.length;k++){c=a[k].name,e=a[k].servings,d=a[k].country;for(var n=0;n<a[k].ingredients.length;n++)i=a[k].ingredients[n].name,l=a[k].ingredients[n].mass,m=a[k].ingredients[n].category,f.push(new h(i,l,l,m));j.recipies.push(new g(c,e,f,d)),f=[]}j.recipiesId=b.id}),p++},1e3),c.$on("$destroy",function(){angular.isDefined(o)&&(a.cancel(o),o=void 0,console.log("Destroy planner-json"))}),e.prototype.addMeal=function(a){this.meals.push(a)},i.prototype.moreIngredient=function(a){this.mass+=a};var q=new Array(7);q[0]="Sunday",q[1]="Monday",q[2]="Tuesday",q[3]="Wednesday",q[4]="Thursday",q[5]="Friday",q[6]="Saturday";var r=new Date((new Date).getTime()),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v);this.days.push(t),r=new Date((new Date).getTime()+864e5),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v),this.days.push(t),r=new Date((new Date).getTime()+1728e5),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v),this.days.push(t),r=new Date((new Date).getTime()+2592e5),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v),this.days.push(t),r=new Date((new Date).getTime()+3456e5),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v),this.days.push(t),r=new Date((new Date).getTime()+432e6),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v),this.days.push(t),r=new Date((new Date).getTime()+5184e5),s=r.getDay(),t=r.getDate(),u=r.getMonth(),v=r.getFullYear(),t=new e(q[s],t+"/"+u+"/"+v),this.days.push(t),this.opencloseSlideMenu=function(){var a=$(".slide-menu-left"),b=$(".hamburger-icon"),c=$(".nav-link-slide");a.toggleClass("is-active"),"false"===b.attr("aria-pressed")?(b.attr("aria-pressed","true"),c[0].focus()):b.attr("aria-pressed","false")};var w=document.activeElement;this.addMealListener=function(){var a=document.getElementById("modal-new-meal");a&&a.addEventListener("keydown",function(a){var b=document.activeElement,c=document.getElementById("modal-meal-type-list"),d=document.getElementById("close-new-meal-modal");9===a.keyCode?a.shiftKey?b.id===c.id&&(a.preventDefault(),d.focus()):b.id===d.id&&(a.preventDefault(),c.focus()):27===a.keyCode&&(j.closeMealModal(),w.focus())})},j.addMealListener(),this.addDayListener=function(){var a=document.getElementById("modal-new-day");a&&a.addEventListener("keydown",function(a){var b=document.activeElement,c=document.getElementById("datepicker"),d=document.getElementById("but-add-new-day"),e=document.getElementById("close-new-day-modal");9===a.keyCode?a.shiftKey?b.id===c.id&&(a.preventDefault(),e.focus()):b.id===e.id?(a.preventDefault(),c.focus()):b.id===c.id&&(a.preventDefault(),d.focus()):27===a.keyCode&&j.closeDayModal()})},j.addDayListener(),this.addGroceriesListener=function(){var a=document.getElementById("modal-groceries-list");a&&a.addEventListener("keydown",function(a){document.activeElement,document.getElementById("close-groceries-list-modal");9===a.keyCode?a.shiftKey?a.preventDefault():a.preventDefault():27===a.keyCode&&j.closeGroceriesListModal()})},j.addGroceriesListener(),this.openMealModal=function(a){w=document.activeElement;var b=$("#modal-new-meal"),c=$("#modal-meal-type-list"),d=$("body");b.toggleClass("active"),d.toggleClass("active"),j.currentDay=a,c.focus()},this.closeMealModal=function(){var a=$("#modal-new-meal");a.toggleClass("active");var b=$("body");b.toggleClass("active"),w.focus()},this.openDayModal=function(){w=document.activeElement;var a=$("#modal-new-day"),b=$("#datepicker");$("#datepicker-error");a.toggleClass("active");var c=$("body");c.toggleClass("active"),b.focus()},this.closeDayModal=function(){var a=$("#modal-new-day"),b=($("#datepicker"),$("#datepicker-error"));a.val(""),b.css("display","none"),b.val(""),$("#datepicker").css("border-color","#e5e5e5"),a.toggleClass("active");var c=$("body");c.toggleClass("active"),w.focus()},this.resetDatepicker=function(){var a=$("#datepicker"),b=$("#datepicker-error");a.val(""),b.css("display","none"),b.val(""),a.css("border-color","#e5e5e5")},this.openGroceriesListModal=function(){w=document.activeElement;var a=$("#modal-groceries-list"),b=$("#close-groceries-list-modal");a.toggleClass("active");var c=$("body");c.toggleClass("active"),b.focus()},this.closeGroceriesListModal=function(){var a=$("#modal-groceries-list");a.toggleClass("active");var b=$("body");b.toggleClass("active"),w.focus()},this.addDay=function(){var a=($("#modal-day-list option:selected").text(),j.datePickerGetDate());if(console.log("is empty"),console.log(a),console.log("null"!==a),"null"!==a){var b=new Date((new Date).getTime()),c=a.split(" "),d=c[0],f="";if(console.log(b.getDate()),f="Jan"===c[1]?"01":"Feb"===c[1]?"02":"Mar"===c[1]?"03":"Apr"===c[1]?"04":"May"===c[1]?"05":"Jun"===c[1]?"06":"Jul"===c[1]?"07":"Aug"===c[1]?"08":"Sep"===c[1]?"09":"Oct"===c[1]?"10":"Nov"===c[1]?"11":"12",d="Mon"===d?"Monday":"Tue"===d?"Tuesday":"Wed"===d?"Wednesday":"Thu"===d?"Thursday":"Fri"===d?"Friday":"Sat"===d?"Saturday":"Sunday",j.validateDate(parseInt(c[2]),f,parseInt(c[3]),b)){var g=c[2]+"/"+f+"/"+c[3],h=new e(d,g);this.days.push(h),j.resetDatepicker()}}else j.dateIsEmpty()},this.validateDate=function(a,b,c,d){console.log("validate");var e=!0;return c>=d.getFullYear()&&b>=d.getMonth()?a>=d.getDate()||(e=!1,j.dateIsInvalid()):(e=!1,j.dateIsInvalid()),e},this.dateIsInvalid=function(){var a=$("#datepicker"),b=$("#datepicker-error");a.css("border-color","#FF0000"),a.css("border-style","double"),b.css("display","initial"),b.text("Please choose a date that is the current date or any date after")},this.dateIsEmpty=function(){var a=$("#datepicker"),b=$("#datepicker-error");a.css("border-color","#FF0000"),a.css("border-style","double"),b.css("display","initial"),b.text("Please choose a date")},this.addMeal=function(){for(var a=$("#modal-meal-type-list option:selected").text(),b=$("#modal-recipe-list option:selected").text(),c={},d=!1,e=0;e<j.recipies.length&&!d;e++)j.recipies[e].name===b&&(c=j.recipies[e],d=!0);j.currentDay.addMeal(new f(a,c))},this.createDatePicker=function(){$("#datepicker").datepicker()},this.datePickerGetDate=function(){return String($("#datepicker").datepicker("getDate"))},j.createDatePicker(),this.cleanGroceriesList=function(){for(var a=0;a<j.meatFishChicken.length;a++)j.meatFishChicken[a].mass=0;for(var a=0;a<j.fruitsVegetables.length;a++)j.fruitsVegetables[a].mass=0;for(var a=0;a<j.milkProducts.length;a++)j.milkProducts[a].mass=0;for(var a=0;a<j.otherFood.length;a++)j.otherFood[a].mass=0},this.createGroceriesList=function(){var a={},b=0,c=0;j.cleanGroceriesList();for(var d=0;d<j.days.length;d++){a=j.days[d].meals,b=a.length;for(var e=0;b>e;e++){c=a[e].recipe.ingredients;for(var f=0;f<c.length;f++){var g=c[f].category,h=c[f].name,k=c[f].unitMass,o=c[f].mass,p={};p=j.listItemExists(h,g),g===l?p?(console.log("inside meat add more"),p.moreIngredient(o)):(console.log("inside meat create"),j.meatFishChicken.push(new i(h,k,o,g))):g===m?p?(console.log("inside fruit add more"),p.moreIngredient(o)):(console.log("inside fruit create"),j.fruitsVegetables.push(new i(h,k,o,g))):g===n?p?(console.log("inside milk add more"),p.moreIngredient(o)):(console.log("inside milk create"),j.milkProducts.push(new i(h,k,o,g))):p?(console.log("inside other food add more"),p.moreIngredient(o)):(console.log("inside other food create"),j.otherFood.push(new i(h,k,o,g)))}}}j.openGroceriesListModal(),console.log(j.meatFishChicken),console.log(j.otherFood)},this.listItemExists=function(a,b){var c=!1,d={},e=null;if(l===b)for(var f=0;f<j.meatFishChicken.length&&!c;f++)d=j.meatFishChicken[f],d.name===a&&(c=!0,e=d);else if(m===b)for(var f=0;f<j.fruitsVegetables.length&&!c;f++)d=j.fruitsVegetables[f],d.name===a&&(c=!0,e=d);else if(n===b)for(var f=0;f<j.milkProducts.length&&!c;f++)d=j.milkProducts[f],d.name===a&&(c=!0,e=d);else for(var f=0;f<j.otherFood.length&&!c;f++)d=j.otherFood[f],d.name===a&&(c=!0,e=d);return e},navigator.geolocation?c.$on("$viewContentLoaded",function(){console.log("sssdsd");var a,b={timeout:1e4},c=function(b){a=b,console.log("sssdsd"),j.locationLat=a.coords.latitude,j.locationLon=a.coords.longitude},d=function(a){console.log("Error occurred. Error code: "+a.code)};navigator.geolocation.getCurrentPosition(c,d,b)}):console.log("Geolocation is not supported for this Browser/OS version yet."),d(function(){console.log(j.locationLat.toString()),$.get("http://maps.googleapis.com/maps/api/geocode/json?latlng="+j.locationLat.toString()+","+j.locationLon.toString()+"&sensor=false").then(function(a){j.country=a.results[7].address_components[0].long_name,console.log(a)})},4e3)}]),angular.module("groceriesappApp").controller("RecipeCtrl",["$interval","$stateParams","recipefinder","$scope",function(a,b,c,d){var e=this;this.recipe="",this.recipeId="",c.getRecipe(b.id).then(function(a){e.recipe=a});var f,g=0;f=a(function(){var a="";g>0?c.getRecipe(b.id).then(function(b){a=b.fileId,a!==recipeId&&(e.recipe=b,e.recipeId=b.fileId)}):c.getRecipe(b.id).then(function(a){e.recipe=a,e.recipeId=a.fileId}),console.log(e.recipe),g++},500),d.$on("$destroy",function(){angular.isDefined(f)&&(a.cancel(f),f=void 0,console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("destroy recipe"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"),console.log("--------"))})}]),angular.module("groceriesappApp").service("recipefinder",function(){this.getRecipies=function(){return $.get("recipies.json")},this.getRecipe=function(a){var b=a+".json";return $.get(b)},this.getPlannerRecipes=function(){return $.get("planner-recipies.json")}}),angular.module("groceriesappApp").controller("RecipiesCtrl",["$interval","recipefinder","$scope",function(a,b,c){var d=this;this.recipies=[],this.recipiesId="",b.getRecipies().then(function(a){d.recipies=a.array,d.recipiesId=a.id});var e,f=0;e=a(function(){var a="";f>0?b.getRecipies().then(function(b){a=b.id,a!==d.recipiesId&&(d.recipies=b.array,d.recipiesId=b.id)}):b.getRecipies().then(function(a){d.recipies=a.array,d.recipiesId=a.id}),f++},500),c.$on("$destroy",function(){angular.isDefined(e)&&(a.cancel(e),e=void 0)})}]),angular.module("groceriesappApp").run(["$templateCache",function(a){a.put("views/planner.html",'<div id="planner-container"> <div id="modal-new-day" class="modal"> <div class="modal-content-box"> <label>Date<input type="text" name="" id="datepicker"></label> <span id="datepicker-error"></span> <button id="but-add-new-day" ng-click="planner.addDay()">Add new day</button> <button id="close-new-day-modal" ng-click="planner.closeDayModal()" aria-label="Close add new day pop up window"> <img alt="Close pop up window" src="images/cancel.svg"> </button> </div> </div> <div id="modal-new-meal" class="modal"> <div class="modal-content-box"> <label>Meal Type <select id="modal-meal-type-list"> <option value="breakfast">breakfast</option> <option value="lunch">lunch</option> <option value="dinner">dinner</option> </select> </label> <label>Recipe <select id="modal-recipe-list"> <option value="" ng-repeat="recipe in planner.recipies">{{recipe.name}}</option> </select> </label> <button ng-click="planner.addMeal()">Add new meal</button> <button id="close-new-meal-modal" ng-click="planner.closeMealModal()" aria-label="Close add new meal pop up window"> <img alt="Close add new meal pop up window" src="images/cancel.svg"> </button> </div> </div> <div id="modal-groceries-list" class="modal"> <div class="modal-content-box"> <button id="close-groceries-list-modal" ng-click="planner.closeGroceriesListModal()" aria-label="Close groceries list"> <img alt="Close groceries list" src="images/cancel.svg"> </button> <div class="food-cat-header"> <img class="food-cat-img" ng-if="planner.meatFishChicken.length>0" src="images/meat.svg" alt=""> <h2 class="food-cat-title" ng-if="planner.meatFishChicken.length>0">Meat, fish and chicken</h2> </div> <ul> <li ng-repeat="item in planner.meatFishChicken"> <div><label for="list-item-{{item.name}}">{{item.name}}: {{item.mass}}gr</label></div><div><input type="checkbox" name="" id="list-item-{{item.name}}"></div> </li> </ul> <div class="food-cat-header"> <img class="food-cat-img" ng-if="planner.fruitsVegetables.length>0" src="images/carrot.svg" alt=""> <h2 class="food-cat-title" ng-if="planner.fruitsVegetables.length>0">Fruits and vegetables</h2> </div> <ul> <li ng-repeat="item in planner.fruitsVegetables"> <div><label for="list-item-{{item.name}}">{{item.name}}: {{item.mass}}gr</label></div><div><input type="checkbox" name="" id="list-item-{{item.name}}"></div> </li> </ul> <div class="food-cat-header"> <img class="food-cat-img" ng-if="planner.milkProducts.length>0" src="images/milk.svg" alt=""> <h2 class="food-cat-title" ng-if="planner.milkProducts.length>0">Milk products</h2> </div> <ul> <li ng-repeat="item in planner.milkProducts"> <div><label for="list-item-{{item.name}}">{{item.name}}: {{item.mass}}gr</label></div><div><input type="checkbox" name="" id="list-item-{{item.name}}"></div> </li> </ul> <div class="food-cat-header"> <img class="food-cat-img" ng-if="planner.otherFood.length>0" src="images/food.svg" alt=""> <h2 class="food-cat-title" ng-if="planner.otherFood.length>0">Other food</h2> </div> <ul> <li ng-repeat="item in planner.otherFood"> <div><label for="list-item-{{item.name}}">{{item.name}}: {{item.mass}}gr</label></div><div><input type="checkbox" name="" id="list-item-{{item.name}}"></div> </li> </ul> </div> </div> <div class="container-btn-groceries-list"> <button id="btn-groceries-list" ng-click="planner.createGroceriesList()">Show Groceries List</button> </div> <div class="day" ng-repeat="day in planner.days"> <h2>{{day.date}}&nbsp;{{day.name}}</h2> <button id="{{day.id}}" class="add-but" ng-click="planner.openMealModal(day)" aria-label="Add new day"><img class="add-icon" src="images/plus.svg" alt="Add new meal button"></button> <div class="meal" ng-repeat="meal in day.meals"> <span>{{meal.type}}</span> <svg height="8" width="6"> <circle cx="3" cy="3" r="3" fill="blue"> Sorry, your browser does not support inline SVG. </svg> <span>{{meal.recipe.name}}</span> </div> </div> <div class="container-btn-new-day"> <button id="btn-new-day" ng-click="planner.openDayModal()"> New day </button> </div> </div>'),a.put("views/recipe.html",'<article id="recipe-container"> <div class="recipe-header"> <div class="recipe-header-info"> <h2>{{recipe.recipe.name}}</h2> <ul> <li>Serves: {{recipe.recipe.serves}}</li> <li>Time: {{recipe.recipe.time}}</li> </ul> <h3 id="nutritional-info">Nutritional info (Per serving)</h3> <table> <tr> <td>Calories</td><td>{{recipe.recipe.nutritionalInfo.calories}}</td> </tr> <tr> <td>Fat</td><td>{{recipe.recipe.nutritionalInfo.fat}}</td> </tr> <tr> <td>Sat Fat</td><td>{{recipe.recipe.nutritionalInfo.satFat}}</td> </tr> <tr> <td>Protein</td><td>{{recipe.recipe.nutritionalInfo.protein}}</td> </tr> <tr> <td>Carbohydrate</td><td>{{recipe.recipe.nutritionalInfo.carbohydrate}}</td> </tr> <tr> <td></td><td></td> </tr> </table> </div> <div class="recipe-header-image"> <img src="images/{{recipe.recipe.image}}" alt=""> </div> </div> <div class="recipe-ingredients"> <h3>INGREDIENTS</h3> <ul> <li ng-repeat="ingredient in recipe.recipe.ingredientsDescription">{{ingredient.description}}</li> </ul> </div> <div class="recipe-directions"> <h3>DIRECTIONS</h3> <ol> <li ng-repeat="description in recipe.recipe.directions">{{description}}</li> </ol> </div> </article>'),a.put("views/recipies.html",'<div id="recipies-container"> <div class="recipe-card" ng-repeat="recipe in recipies.recipies"> <img src="images/{{recipe.simage}}" alt=""> <h2><a ui-sref="recipe({id: recipe.id})">{{recipe.name}}</a></h2> <span>{{recipe.description}}</span> </div> </div>')}]);